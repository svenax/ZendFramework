<!-- EN-Revision: 11224 -->
<sect1 id="zend.paginator.usage">
    <title>Utilisation</title>

    <sect2 id="zend.paginator.usage.paginating">
        <title>Paginer des collections de données</title>

        <para>Afin de pouvoir paginer des éléments, <code>Zend_Paginator</code> doit posséder une manière générique
        d'accéder aux sources de données. De ce fait, tous les accès aux données se font via des adaptateurs de sources.
        Plusieurs adaptateurs existent par défaut :</para>

        <table id="zend.paginator.usage.paginating.adapters">
            <title>Adaptateurs pour <code>Zend_Paginator</code></title>

            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Adaptateur</entry>

                        <entry>Description</entry>
                    </row>
                </thead>

                <tbody>
                    <row>
                        <entry>Array</entry>

                        <entry>Utilise un tableau PHP</entry>
                    </row>

                    <row>
                        <entry>DbSelect</entry>

                        <entry>Utilise une instance de <link
                        linkend="zend.db.select"><code>Zend_Db_Select</code></link></entry>
                    </row>

                    <row>
                        <entry>Iterator</entry>

                        <entry>Utilise une instance implémentant <ulink
                        url="http://www.php.net/~helly/php/ext/spl/interfaceIterator.html"><code>Iterator</code></ulink></entry>
                    </row>

                    <row>
                        <entry>Null</entry>

                        <entry>N'utilise pas <code>Zend_Paginator</code> pour la pagination. En revanche, les options et
                        capacités de contrôle de la pagination restent disponibles.</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>Pour créer une instance de <code>Zend_Paginator</code>, vous devez spécifier un adaptateur à son
        constructeur:</para>

        <para><programlisting role="php"><![CDATA[
$paginator = new Zend_Paginator(new Zend_Paginator_Adapter_Array($array));
]]></programlisting></para>

        <para>Pour une meilleure intégration, vous pouvez utiliser la fabrique <code>factory()</code>:</para>

        <para><programlisting role="php"><![CDATA[
$paginator = Zend_Paginator::factory($array);
]]></programlisting></para>

        <note><para>
             Pour l'adaptateur Null, il faut spécifier un chiffre à son constructeur en lieu et place de la collection de données. 
        </para></note>

        <para>Il faut ensuite dire au paginateur quelle page utiliser pour calculer les résultats:</para>

        <para><programlisting role="php"><![CDATA[
$paginator->setCurrentPageNumber($pageNumber);
]]></programlisting></para>

        <para>La manière la plus simple de suivre et scruter cette valeur est via l'URL. Nous recommandons l'utilisation
        d'un routeur compatible avec <code>Zend_Controller_Router_Interface</code>, mais ceci n'est pas
        nécessaire.</para>

        <para>Voici une route que vous pourriez définir dans un fichier de configuration INI:</para>

        <para><programlisting role="php"><![CDATA[
routes.example.route = articles/:articleName/:pageNumber
routes.example.defaults.controller = articles
routes.example.defaults.action = view
routes.example.defaults.pageNumber = 1
routes.example.reqs.articleName = \w+
routes.example.reqs.pageNumber = \d+
]]></programlisting></para>

        <para>Avec une telle route (et en utilisant les composants MVC de Zend Framework), vous pourriez spécifier le
        numéro de la page de cette manière :</para>

        <para><programlisting role="php"><![CDATA[
$paginator->setCurrentPageNumber($this->_getParam('pageNumber'));
]]></programlisting></para>

        <para>Il y a d'autres options disponibles, voyez <link linkend="zend.paginator.configuration">la
        configuration</link> pour plus de détails.</para>

        <para>Enfin, il faut passer l'instance du paginateur à votre vue. Si vous utilisez <code>Zend_View</code> avec
        l'aide d'action <code>ViewRenderer</code>, ceci fonctionnera :</para>

        <para><programlisting role="php"><![CDATA[
$this->view->paginator = $paginator;
]]></programlisting></para>
    </sect2>

    <sect2 id="zend.paginator.rendering">
        <title>Rendre des pages avec les scripts de vue</title>

        <para>Le script de vue va être utilisé pour rendre les éléments de la page (bien sûr si
        <code>Zend_Paginator</code> est utilisé à cet effet), et pour afficher les éléments relatifs au contrôle de la
        pagination.</para>

        <para>Comme <code>Zend_Paginator</code> implémente l'interface SPL <ulink
        url="http://www.php.net/~helly/php/ext/spl/interfaceIteratorAggregate.html"><code>IteratorAggregate</code></ulink>,
        boucler sur les éléments et les afficher est très simple.</para>

        <para><programlisting role="php"><![CDATA[
<html>
<body>
<h1>Example</h1>
<?php if (count($this->paginator)): ?>
<ul>
<?php foreach ($this->paginator as $item): ?>
  <li><?= $item; ?></li>
<?php endforeach; ?>
</ul>
<?php endif; ?>

<?= $this->paginationControl($this->paginator, 'Sliding', 'my_pagination_control.phtml'); ?>
</body>
</html>
]]></programlisting></para>

        <para>Notez l'appel à l'aide de vue en fin de script. <code>PaginationControl</code> prend en paramètre
        l'instance du paginateur, un type de défilement (optionnel), et un partial de vue (optionnel).</para>

        <para>Malgré qu'ils soient optionnels, les 2 derniers éléments sont importants. Alors que le partial va
        déterminer comment <emphasis>présenter</emphasis> les données, le type de défilement définira la manière dont
        ils se <emphasis>comportent</emphasis> Disons que le partial ressemble à un contrôle de recherche, comme le
        suivant:</para>

        <para><inlinegraphic align="center" fileref="figures/zend.paginator.usage.rendering.control.png" format="PNG"
        valign="middle" /></para>

        <para>Que se passe-t-il lorsque l'utilisateur clique sur le lien "next" quelques fois? Plusieurs choses peuvent
        arriver. Le numéro de la page courante pourrait rester au milieu (comme c'est le cas sur Yahoo!), ou il pourrait
        aussi bien avancer à la fin de la fourchette des pages et apparaître encore à gauche lorsque l'utilisateur
        clique alors sur "next". Le nombre de pages pourrait alors s'étendre ou se comprimer alors que l'utilisateur
        avance ("scroll") à travers (comme chez Google).</para>

        <para>Il existe 4 types de défilement intégrés dans Zend Framework :</para>

        <table id="zend.paginator.usage.rendering.scrolling-styles">
            <title>Types de défilement pour <code>Zend_Paginator</code></title>

            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Type de défilement</entry>

                        <entry>Description</entry>
                    </row>
                </thead>

                <tbody>
                    <row>
                        <entry>All</entry>

                        <entry>Retourne toutes les pages. Très pratique lorsqu'il y a peu de pages totales.</entry>
                    </row>

                    <row>
                        <entry>Elastic</entry>

                        <entry>Un défilement de type Google qui s'étend et se contracte au fur et à mesure que
                        l'utilisateur avance dans les pages de résultats.</entry>
                    </row>

                    <row>
                        <entry>Jumping</entry>

                        <entry>Alors que l'utilisateur défile, le nombre de pages avance à la fin d'une échelle donnée,
                        puis recommence au début de l'échelle suivante.</entry>
                    </row>

                    <row>
                        <entry>Sliding</entry>

                        <entry>Un défilement de type Yahoo! qui positionne la page en cours au centre d'une échelle de
                        pages, le plus justement et près possible. Ce type de défilement est le type par défaut.</entry>
                    </row>
                </tbody>
            </tgroup>
        </table>

        <para>En spécifiant le partial de vue par défaut, le défilement et l'instance de vue, vous pouvez alors vous
        affranchir totalement des appels à <code>PaginationControl</code> :</para>

        <para><programlisting role="php"><![CDATA[
Zend_Paginator::setDefaultScrollingStyle('Sliding');
Zend_View_Helper_PaginationControl::setDefaultViewPartial(
    'my_pagination_control.phtml'
);
$paginator->setView($view);
]]></programlisting></para>

        <para>Utilisez dès lors un simple <code>echo</code> dans le script de vue pour le rendu du paginateur
        complet:</para>

        <para><programlisting role="php"><![CDATA[
<?= $this->paginator; ?>
]]></programlisting></para>

        <sect3 id="zend.paginator.usage.rendering.example-controls">
            <title>Exemples de contrôles de pagination</title>

            <para>Voici quelques exemples qui vous aideront à démarrer avec le paginateur:</para>

            <para>Pagination de recherche :<programlisting role="php"><![CDATA[
<!-- 
Voir http://developer.yahoo.com/ypatterns/pattern.php?pattern=searchpagination
-->

<?php if ($this->pageCount): ?> 
<div class="paginationControl">
<!-- Previous page link --> 
<?php if (isset($this->previous)): ?> 
  <a href="<?= $this->url(array('page' => $this->previous)); ?>">
    &lt; Previous
  </a> |
<?php else: ?> 
  <span class="disabled">&lt; Previous</span> | 
<?php endif; ?> 

<!-- Numbered page links -->
<?php foreach ($this->pagesInRange as $page): ?> 
  <?php if ($page != $this->current): ?>
    <a href="<?= $this->url(array('page' => $page)); ?>"><?= $page; ?></a> | 
  <?php else: ?>
    <?= $page; ?> | 
  <?php endif; ?>
<?php endforeach; ?>

<!-- Next page link --> 
<?php if (isset($this->next)): ?> 
  <a href="<?= $this->url(array('page' => $this->next)); ?>">Next &gt;</a>
<?php else: ?> 
  <span class="disabled">Next &gt;</span>
<?php endif; ?> 
</div> 
<?php endif; ?>
]]></programlisting></para>

            <para>Pagination d'objets :<programlisting role="php"><![CDATA[
<!-- 
Voir http://developer.yahoo.com/ypatterns/pattern.php?pattern=itempagination
-->

<?php if ($this->pageCount): ?> 
<div class="paginationControl">
<?= $this->firstItemNumber; ?> - <?= $this->lastItemNumber; ?> 
of <?= $this->totalItemCount; ?>

<!-- First page link -->
<?php if (isset($this->previous)): ?>
  <a href="<?= $this->url(array('page' => $this->first)); ?>">First</a> | 
<?php else: ?>
  <span class="disabled">First</span> |
<?php endif; ?> 

<!-- Previous page link --> 
<?php if (isset($this->previous)): ?> 
  <a href="<?= $this->url(array('page' => $this->previous)); ?>">
    &lt; Previous
  </a> |
<?php else: ?> 
  <span class="disabled">&lt; Previous</span> | 
<?php endif; ?> 

<!-- Next page link --> 
<?php if (isset($this->next)): ?> 
  <a href="<?= $this->url(array('page' => $this->next)); ?>">Next &gt;</a> |
<?php else: ?> 
  <span class="disabled">Next &gt;</span> |
<?php endif; ?>

<!-- Last page link -->
<?php if (isset($this->next)): ?>
  <a href="<?= $this->url(array('page' => $this->last)); ?>">Last</a>
<?php else: ?>
  <span class="disabled">Last</span>
<?php endif; ?> 

</div> 
<?php endif; ?>
]]></programlisting></para>

            <para>Pagination Dropdown :<programlisting role="php"><![CDATA[
<?php if ($this->pageCount): ?> 
<select id="paginationControl" size="1"> 
<?php foreach ($this->pagesInRange as $page): ?>
  <?php $selected = ($page == $this->current) ? ' selected="selected"' : ''; ?>
  <option value="<?= $this->url(array('page' => $page)); ?>"<?= $selected ?>>
    <?= $page; ?>
  </option> 
<?php endforeach; ?>
</select>
<?php endif; ?>

<script type="text/javascript"
    src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.2/prototype.js">
</script>
<script type="text/javascript">
$('paginationControl').observe('change', function() {
    window.location = this.options[this.selectedIndex].value;
})
</script>
]]></programlisting></para>
        </sect3>

        <sect3 id="zend.paginator.usage.rendering.properties">
            <title>Liste des propriétés</title>

            <para>Les options suivantes sont disponibles pour contrôler la pagination dans les partials de vue :</para>

            <table id="zend.paginator.usage.rendering.properties.table">
                <title>Propriétés disponibles aux partials de vue</title>

                <tgroup cols="3">
                    <thead>
                        <row>
                            <entry>Propriété</entry>

                            <entry>Type</entry>

                            <entry>Description</entry>
                        </row>
                    </thead>

                    <tbody>
                        <row>
                            <entry>first</entry>

                            <entry>entier</entry>

                            <entry>numéro de la première page</entry>
                        </row>

                        <row>
                            <entry>firstItemNumber</entry>

                            <entry>entier</entry>

                            <entry>numéro absolu du premier objet(item) dans cette page</entry>
                        </row>

                        <row>
                            <entry>firstPageInRange</entry>

                            <entry>entier</entry>

                            <entry>Première page dans l'échelle retournée par le type de défilement</entry>
                        </row>

                        <row>
                            <entry>current</entry>

                            <entry>entier</entry>

                            <entry>numéro de la page en cours</entry>
                        </row>

                        <row>
                            <entry>currentItemCount</entry>

                            <entry>entier</entry>

                            <entry>Nombre d'objets sur cette page</entry>
                        </row>

                        <row>
                            <entry>last</entry>

                            <entry>entier</entry>

                            <entry>Numéro de la dernière page</entry>
                        </row>

                        <row>
                            <entry>lastItemNumber</entry>

                            <entry>entier</entry>

                            <entry>Numéro absolu du dernier objet sur cette page</entry>
                        </row>

                        <row>
                            <entry>lastPageInRange</entry>

                            <entry>entier</entry>

                            <entry>Dernière page dans l'échelle retournée par le type de défilement</entry>
                        </row>

                        <row>
                            <entry>next</entry>

                            <entry>entier</entry>

                            <entry>Numéro de la page suivante</entry>
                        </row>

                        <row>
                            <entry>pageCount</entry>

                            <entry>entier</entry>

                            <entry>Nombre de pages</entry>
                        </row>

                        <row>
                            <entry>pagesInRange</entry>

                            <entry>tableau (array)</entry>

                            <entry>Tableau des pages retournées par le type de défilement</entry>
                        </row>

                        <row>
                            <entry>previous</entry>

                            <entry>entier</entry>

                            <entry>Numéro de la page précédente</entry>
                        </row>

                        <row>
                            <entry>totalItemCount</entry>

                            <entry>entier</entry>

                            <entry>Nombre total d'objets</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </sect3>
    </sect2>
</sect1>