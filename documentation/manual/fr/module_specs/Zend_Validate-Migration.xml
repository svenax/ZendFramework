<?xml version="1.0" encoding="UTF-8"?>
<!-- Reviewed: no -->
<sect1 id="zend.validate.migration">

    <title>Migration depuis les versions précédentes</title>

    <para>
        L'<acronym>API</acronym> de <classname>Zend_Validate</classname> a changé quelques fois.
        Ce guide va vous permettre de noter les différences entre les versions.
    </para>

    <sect2 id="zend.validate.migration.fromoneninetooneten">
        <title>Migrer de 1.9 à 1.10</title>
        <sect3 id="zend.validate.migration.fromoneninetooneten.selfwritten">
            <title>Adaptateurs personnels</title>

            <para>
                Lorsqu'une erreur apparait dans un adaptateur crée de toute pièce,
                <methodname>_error()</methodname> doit être appelée. Avant Zend Framework 1.10, il était
                possible d'appeler cette méthode sans aucun paramètre. Le premier template de message d'erreur
                était alors utilisé.
            </para>

            <para>
                Ce comportement est problématique lorsque vous avez des validateurs retournant plusieurs messages.
                Aussi, étendre un validateur peut mener à des comportements inattendus dans une telle situation,
                comme par exemple l'apparition du mauvais message d'erreur.
            </para>

            <programlisting language="php"><![CDATA[
My_Validator extends Zend_Validate_Abstract
{
    public isValid($value)
    {
        ...
        $this->_error(); // Résultat inattendu
        ...
    }
}
]]></programlisting>

            <para>
                Pour éviter ces problèmes <methodname>_error()</methodname> doit desormais
                prendre obligatoirement un paramètre.
            </para>

            <programlisting language="php"><![CDATA[
My_Validator extends Zend_Validate_Abstract
{
    public isValid($value)
    {
        ...
        $this->_error(self::MY_ERROR); // Ok, erreur définie
        ...
    }
}
]]></programlisting>
        </sect3>

        <sect3 id="zend.validate.migration.fromoneninetooneten.datevalidator">
            <title>Simplification dans le validateur des dates</title>

            <para>
                Avant Zend Framework 1.10, 2 messages identiques étaient envoyés dans le validateur
                des dates. <constant>NOT_YYYY_MM_DD</constant> et
                <constant>FALSEFORMAT</constant>. Depuis Zend Framework 1.10, seul
                <constant>FALSEFORMAT</constant> sera retourné lorsque la date passée ne correspond pas
                au format demandé.
            </para>
        </sect3>

        <sect3 id="zend.validate.migration.fromoneninetooneten.barcodevalidator">
            <title>Corrections dans Alpha, Alnum et Barcode</title>

            <para>
                Avant Zend Framework 1.10, les messages dans les 2 validateurs barcode, le Alpha
                et le Alnum étaient identiques. Des problèmes pouvaient alors faire surface avec des
                messages personnalisés, des traducteurs ou des instances multiples des validateurs.
            </para>

            <para>
                Depuis Zend Framework 1.10, les valeurs des constantes ont changé pour être uniques.
                Si vous utilisiez les constantes comme le manuel le recommande, aucun changement n'est nécessaire.
                Mais si vous utilisiez les messages d'erreurs, alors il faudra les changer. Voici les changements
                opérés:
            </para>

            <table id="zend.validate.migration.fromoneninetooneten.barcodevalidator.table">
                <title>Messages de validation disponibles</title>
                <tgroup cols="3">
                    <thead>
                        <row>
                            <entry>Validateur</entry>
                            <entry>Constante</entry>
                            <entry>Valeur</entry>
                        </row>
                    </thead>

                    <tbody>
                        <row>
                            <entry>Alnum</entry>
                            <entry><constant>STRING_EMPTY</constant></entry>
                            <entry>alnumStringEmpty</entry>
                        </row>

                        <row>
                            <entry>Alpha</entry>
                            <entry><constant>STRING_EMPTY</constant></entry>
                            <entry>alphaStringEmpty</entry>
                        </row>

                        <row>
                            <entry>Barcode_Ean13</entry>
                            <entry><constant>INVALID</constant></entry>
                            <entry>ean13Invalid</entry>
                        </row>

                        <row>
                            <entry>Barcode_Ean13</entry>
                            <entry><constant>INVALID_LENGTH</constant></entry>
                            <entry>ean13InvalidLength</entry>
                        </row>

                        <row>
                            <entry>Barcode_UpcA</entry>
                            <entry><constant>INVALID</constant></entry>
                            <entry>upcaInvalid</entry>
                        </row>

                        <row>
                            <entry>Barcode_UpcA</entry>
                            <entry><constant>INVALID_LENGTH</constant></entry>
                            <entry>upcaInvalidLength</entry>
                        </row>

                        <row>
                            <entry>Digits</entry>
                            <entry><constant>STRING_EMPTY</constant></entry>
                            <entry>digitsStringEmpty</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>

        </sect3>
    </sect2>
</sect1>
